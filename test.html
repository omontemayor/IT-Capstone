<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Passkey Test</title>
</head>
<body>
  <h1>IT-Capstone Passkey Test</h1>
  <input type="email" id="email" placeholder="Email" />
  <button id="register">Register Passkey</button>
  <button id="login">Login Passkey</button>
  <script src="https://cdn.jsdelivr.net/npm/@simplewebauthn/browser@latest/dist/simplewebauthn-browser.min.js"></script>
  <script>
    const API = 'http://localhost:3000/webauthn';
    async function register() {
      const email = document.getElementById('email').value;
      const opts = await fetch(\\/register/options\, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email})}).then(r=>r.json());
      const attResp = await SimpleWebAuthnBrowser.startRegistration(opts);
      const verification = await fetch(\\/register/verify\, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(attResp)}).then(r=>r.json());
      alert(verification.ok ? '? Registered!' : '? Failed');
    }
    async function login() {
      const email = document.getElementById('email').value;
      const opts = await fetch(\\/authenticate/options\, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email})}).then(r=>r.json());
      const authResp = await SimpleWebAuthnBrowser.startAuthentication(opts);
      const verification = await fetch(\\/authenticate/verify\, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(authResp)}).then(r=>r.json());
      alert(verification.ok ? '? Logged in!' : '? Failed');
    }
    document.getElementById('register').addEventListener('click', register);
    document.getElementById('login').addEventListener('click', login);
  </script>
</body>
</html>
